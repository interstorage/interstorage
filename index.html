<!doctype html>
<html>
 <body>
  <script>
   (function(){
     
     // Technologies used:
     //  * data uri
     //  * cross-origin communication
     //  * promises
     
     var frame = document.createElement("iframe");
     frame.src = "data:text/html;charset=utf-8,%3C%21document%20html%3E%0D%0A%3Chtml%3E%0D%0A%20%3Chead%3E%0D%0A%20%20%3Cmeta%20charset%3Dutf-8%20%2F%3E%0D%0A%20%20%3Ctitle%3EInterStorage%3C%2Ftitle%3E%0D%0A%20%3C%2Fhead%3E%0D%0A%20%3Cbody%3E%0D%0A%20%20%3Cscript%3E%0D%0A%20%20%20var%20stored%3B%0D%0A%20%20%20var%20date%20%3D%20new%20Date%28%29%3B%0D%0A%20%20%20%0D%0A%20%20%20function%20update%28%29%7B%0D%0A%20%20%20%20%20date.setTime%28date.getTime%28%29%2B31104000000%29%3B%0D%0A%20%20%20%20%20document.cookie%20%3D%20%22x-global-storage%3D%22%2B%0D%0A%20%20%20%20%20%20%20%20%20%20JSON.stringify%28stored%29%2B%0D%0A%20%20%20%20%20%20%20%20%20%20%22%3B%20expires%3D%22%2Bdate.toGMTString%28%29%2B%22%3B%20path%3D%2F%22%3B%0D%0A%20%20%20%7D%0D%0A%20%20%20%0D%0A%20%20%20%28function%28%29%7B%0D%0A%20%20%20%20%20%0D%0A%20%20%20%20%20var%20arr%20%3D%20document.cookie.split%28%27%3B%27%29%2C%20i%20%3D%20-1%2C%20c%3B%0D%0A%20%20%20%20%20%0D%0A%20%20%20%20%20while%20%28%2B%2Bi%20%3C%20arr.length%29%7B%0D%0A%20%20%20%20%20%20%20c%20%3D%20arr%5Bi%5D.trimLeft%28%29%3B%0D%0A%20%20%20%20%20%20%20if%28%20%2F%5Ex-global-storage%3D%2F.test%28c%29%20%29%7B%0D%0A%20%20%20%20%20%20%20%20%20stored%20%3D%20JSON.parse%28%20c.substr%2817%29%20%20%29%3B%0D%0A%20%20%20%20%20%20%20%20%20%2F%2A%2017%20%3D%3D%3D%20%22x-global-storage%3D%22.length%20%2A%2F%0D%0A%20%20%20%20%20%20%20%20%20break%3B%0D%0A%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%0D%0A%20%20%20%20%20if%28%20%21stored%20%29%7B%20stored%20%3D%20%7B%7D%3B%20%7D%0D%0A%20%20%20%20%20%0D%0A%20%20%20%7D%29%28%29%3B%0D%0A%20%20%20%0D%0A%20%20%20%0D%0A%20%20%20window.addEventListener%28%22message%22%2Cfunction%28e%29%7B%0D%0A%20%20%20%20%20switch%28e.data%5B0%5D%29%7B%0D%0A%20%20%20%20%20%20%20case%20%22v%22%3A%0D%0A%20%20%20%20%20%20%20%20%20e.source.postMessage%280%29%3B%0D%0A%20%20%20%20%20%20%20%20%20break%3B%0D%0A%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20%20case%20%22get%22%3A%0D%0A%20%20%20%20%20%20%20%20%20e.source.postMessage%28%5B%0D%0A%20%20%20%20%20%20%20%20%20%20%20e.data%5B1%5D%2C%0D%0A%20%20%20%20%20%20%20%20%20%20%20stored%5B%20e.data%5B2%5D%20%5D%0D%0A%20%20%20%20%20%20%20%20%20%5D%2C%20%22%2A%22%29%3B%0D%0A%20%20%20%20%20%20%20%20%20break%3B%0D%0A%20%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20%20case%20%22set%22%3A%0D%0A%20%20%20%20%20%20%20%20%20stored%5B%20e.data%5B1%5D%20%5D%20%3D%20e.data%5B2%5D%3B%0D%0A%20%20%20%20%20%20%20%20%20update%28%29%3B%0D%0A%20%20%20%20%20%20%20%20%20break%3B%0D%0A%20%20%20%20%20%20%20%0D%0A%20%20%20%20%20%20%20case%20%22rm%22%3A%0D%0A%20%20%20%20%20%20%20%20%20delete%20stored%5B%20e.data%5B1%5D%20%5D%3B%0D%0A%20%20%20%20%20%20%20%20%20break%3B%0D%0A%20%20%20%20%20%20%20%0D%0A%20%20%20%20%20%7D%0D%0A%20%20%20%7D%29%3B%0D%0A%20%20%3C%2Fscript%3E%0D%0A%20%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E";
     frame.style.display = "none";
     document.body.appendChild(frame);
     Object.freeze(frame);
     
     var pending = [];
     
     window.globalStorage = Object.create(null);
     
     globalStorage.get = function(name){
       frame.contentWindow.postMessage([
        "get", pending.length, name
       ],"*");
       return new Promise(function(r){
         pending.push(r);
       });
     };
     
     globalStorage.set = function(name,value){
       frame.contentWindow.postMessage([
        "set", name, value
       ],"*");
     };
     
     globalStorage.remove = function(name){
       frame.contentWindow.postMessage([
        "rm", name
       ],"*");
     };
     
     addEventListener("message",function(e){
       if(e.source !== frame.contentWindow){ return; }
       pending[ e.data[0] ]( e.data[1] );
     });
     
   })();
  </script>
 </body>
</html>
